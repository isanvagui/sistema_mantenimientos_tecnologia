<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>App Laboratorios Colmayor</title>
  <link rel="stylesheet" href="https://bootswatch.com/5/materia/bootstrap.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/estilos.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='img/Escudo_Colmayor.png') }}" type="image/x-icon">
</head>

<body>
  <!-- Barra lateral -->
  <div class="sidebar collapsed" id="sidebar">
    <!-- Bot√≥n para retraer y expandir el sidebar -->
    <div class="toggle-btn" id="toggle-btn" onclick="toggleSidebar()">
      <i class="fas fa-bars"></i>
    </div>

    <!-- Siempre visibles -->
    <a href="{{ url_for('home') }}" data-icon="üè†"> Inicio</a>
    <a href="{{ url_for('indexTecnologia') }}" data-icon="ü§ñ"> Tecnologia</a>
    
    <!-- Si estamos en modulo TECNOLOGIA -->
    {% if request.path == url_for('indexTecnologia') %}
      <a href="{{ url_for('AGREGAR_NUEVA_PERSONA_TECNOLOGIA') }}" data-icon="üöö"> Agregar Persona Responsable</a>
      <a id="toggleFormBtn" class="btn-indexSalud" data-icon="‚ûï"> Agregar Equipo Manual</a>
      <a id="toggleForm" class="btn-indexSalud" data-icon="üì©"> Agregar Equipos Masivos .CSV</a>
      
      <a id="toggleFor"
          class="btn-indexSalud"
          data-bs-toggle="modal"
          data-bs-target="#modalGuardar"
          title="Actualizar fechas y guarda en historial" data-icon="üîÅ">
           Actualizaci√≥n Masiva
      </a>

      <a href="{{ url_for('index_otros_equipos_tecnologia') }}" data-icon="üì¶"> Otros Equipos de Tecnologia</a>
      
      <a href="{{ url_for('equipos_debaja_tecnologia') }}" data-icon="üóëÔ∏è"> Equipos de Baja</a>
      <a href="{{ url_for('exportCsv') }}" data-icon="üìÑ"> Exportar Equipos Activos</a>
    {% elif request.path == url_for('index_otros_equipos_tecnologia') %}
      <a id="toggleFor"
          class="btn-indexSalud"
          data-bs-toggle="modal"
          data-bs-target="#modalOpciones"
          title="Actualizar fechas y guarda en historial" data-icon="üîÅ">
           Actualizaci√≥n Masiva
      </a>
    {% elif request.path == url_for('equipos_debaja_tecnologia') %}
      <a href="{{ url_for('exportExcelDeBaja') }}" data-icon="üìÇ"  id="btnExportarBaja"> Exportar Equipos De Baja</a>
    {% endif %}
    
    <a class="navbar-brand"></a>
    
    <!-- Cerrar sesi√≥n -->
    <a href="{{ url_for('logout') }}" data-icon="üîí" class="logout"> Cerrar Sesi√≥n</a>
  </div>

  <!-- Contenido principal -->
  <div class="content" id="content">
    <div class="container-layout">
      {% block body %}
      {% endblock %}
    </div>
  </div>

  <!-- Script para el colapso del sidebar -->
  <script>
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('expanded'); // Alterna la clase expanded
    }

    // A√±adir evento para expandir el sidebar al pasar el mouse
    const sidebar = document.getElementById("sidebar");
    sidebar.addEventListener("mouseenter", () => {
        sidebar.classList.add("expanded"); // Expande al hacer hover
    });

    sidebar.addEventListener("mouseleave", () => {
        sidebar.classList.remove("expanded"); // Colapsa al salir
    });

    // Mostrar el texto de los enlaces al expandir
    sidebar.addEventListener("mouseenter", () => {
        const links = sidebar.querySelectorAll('a');
        links.forEach(link => link.classList.add('visible')); // A√±ade clase para mostrar texto
    });

    sidebar.addEventListener("mouseleave", () => {
        const links = sidebar.querySelectorAll('a');
        links.forEach(link => link.classList.remove('visible')); // Remueve clase para ocultar texto
    });

  </script>

<!-- // Script para el boton Exportar equipos de baja -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("btnExportarBaja");
  if (!btn) return;

  btn.addEventListener("click", async (e) => {
    e.preventDefault();

    const seleccionados = [];
    document.querySelectorAll(".equipo-checkbox:checked").forEach(chk => {
      seleccionados.push({
        cod_articulo: chk.dataset.codigo,
        nombre_equipo: chk.dataset.nombre
      });
    });

    if (seleccionados.length === 0) {
      alert("Seleccione al menos un equipo");
      return;
    }
    if (seleccionados.length > 20) {
      alert("No puede seleccionar m√°s de 20 equipos a la vez");
      return;
    }

    try {
      const resp = await fetch("{{ url_for('exportExcelDeBaja') }}", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": typeof csrf_token !== "undefined" ? csrf_token : ""
        },
        body: JSON.stringify({ equipos: seleccionados })
      });

      if (!resp.ok) {
        const ct = resp.headers.get("content-type") || "";
        if (ct.includes("application/json")) {
          const j = await resp.json();
          throw new Error(j.error || "Error al generar Excel");
        }
        throw new Error("Error al generar Excel");
      }

      const blob = await resp.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "equipos_baja.xlsx";
      document.body.appendChild(a);
      a.click();
      a.remove();
      window.URL.revokeObjectURL(url);
    } catch (err) {
      alert(err.message || "Error al generar Excel");
    }
  });
});
</script>

  <script type="text/javascript" src="{{url_for('static', filename='js/main.js')}}"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
    integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"
    integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD"
    crossorigin="anonymous"></script>
</body>

</html>
